# üîê Testing Credentials & Endpoints

## üåê API Endpoints

| Service | URL | Status |
|---------|-----|--------|
| Backend API | `http://localhost:4000` | Running in Docker |
| Frontend | `http://localhost:3000` | Running in Docker |
| Database | `localhost:5434` | PostgreSQL in Docker |
| PgAdmin | `http://localhost:5051` | Web UI for DB |

---

## üë§ Default Login Credentials

### Admin User
```
Email: admin@example.com
Password: admin123
Role: ADMIN
Permissions: Full access to all features
```

### Supervisor User
```
Email: supervisor@example.com
Password: supervisor123
Role: SUPERVISOR_POA
Permissions: Can manage POA templates and activities
```

### Coordinator User
```
Email: coordinator@example.com
Password: coordinator123
Role: COORDINATOR
Permissions: Can view and edit agreement activities
```

### Regular User
```
Email: user@example.com
Password: user123
Role: USER
Permissions: Limited read access
```

---

## üîå Database Connection

### PostgreSQL (Docker)
```
Host: localhost
Port: 5434
Username: poauser
Password: poapass123
Database: poa_tracker
```

### PgAdmin (Web UI)
```
URL: http://localhost:5051
Email: admin@poa.com
Password: admin123
```

---

## üìù Sample Data IDs (After First Run)

Once you run the tests, these will be populated:

```bash
# After TEST 2 (Login)
JWT_TOKEN=eyJhbGciOiJIUzI1NiIs...

# After TEST 3 (Get Programs)
PROGRAM_ID=550e8400-e29b-41d4-a716-446655440010

# After TEST 4 (Create Template)
TEMPLATE_ID=<generated by test>

# After TEST 5 (Add Activity)
ACTIVITY_ID=<generated by test>

# After TEST 7 (Get Agreements)
AGREEMENT_ID=<first agreement ID>

# After TEST 8 (Apply Template)
POA_ID=<generated by test>

# After TEST 9 (Get Activities)
CREATED_ACTIVITY_ID=<generated by test>
```

---

## üéØ Key Programs

These programs should exist in the database:

| ID | Name | Description | Status |
|---|---|---|---|
| 550e8400-e29b-41d4-a716-446655440010 | Renta Ciudadana | Citizen income program | Active |
| 550e8400-e29b-41d4-a716-446655440011 | Compensaci√≥n IVA | VAT compensation | Active |
| 550e8400-e29b-41d4-a716-446655440012 | Renta Joven | Youth income program | Active |

---

## üîë HTTP Headers

All requests (except /auth/login and /health) require:

```
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json
```

Example:
```bash
curl -X GET http://localhost:4000/programs \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..." \
  -H "Content-Type: application/json"
```

---

## üìö API Endpoints Reference

### Health
```
GET /health
Authentication: No
Response: { status: "UP" }
```

### Authentication
```
POST /auth/login
Body: { email: "admin@example.com", password: "admin123" }
Response: { access_token: "...", user: {...} }
```

### Programs
```
GET /programs
GET /programs/:id
Authentication: Required (Bearer JWT)
```

### POA Templates
```
POST /poa-templates                                    [Create]
GET /poa-templates                                     [List]
GET /poa-templates/:id                                 [Get one]
PATCH /poa-templates/:id                               [Update]
DELETE /poa-templates/:id                              [Delete]
POST /poa-templates/:id/activities                      [Add activity]
GET /poa-templates/:id/activities                       [Get activities]
DELETE /poa-templates/:id/activities/:activityId        [Remove activity]
Authentication: Required (Bearer JWT)
Roles: ADMIN, SUPERVISOR_POA
```

### Agreements
```
GET /agreements                                         [List]
GET /agreements/:id                                     [Get one]
POST /agreements/:id/apply-template/:templateId?year=YYYY  [Apply template]
Authentication: Required (Bearer JWT)
Roles: ADMIN, SUPERVISOR_POA
```

### Agreement Activities
```
GET /agreement-activities                              [List]
GET /agreement-activities/:id                          [Get one]
PATCH /agreement-activities/:id                        [Update progress/status]
Authentication: Required (Bearer JWT)
Roles: ADMIN, SUPERVISOR_POA, COORDINATOR
```

---

## üß™ Quick Curl Commands

### Login and Save Token
```bash
# Linux/Mac/GitBash
TOKEN=$(curl -s -X POST http://localhost:4000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"admin123"}' | jq -r '.access_token')

echo $TOKEN

# Windows CMD (set token and use it)
curl -i http://localhost:4000/programs \
  -H "Authorization: Bearer %JWT_TOKEN%"
```

### Create Template
```bash
curl -X POST http://localhost:4000/poa-templates \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Template",
    "description": "Test Description"
  }'
```

### Add Activity to Template
```bash
curl -X POST http://localhost:4000/poa-templates/{TEMPLATE_ID}/activities \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Activity Name",
    "description": "Activity Description",
    "meta": 1000,
    "unit": "personas",
    "programId": "550e8400-e29b-41d4-a716-446655440010"
  }'
```

### Apply Template to Agreement
```bash
curl -X POST http://localhost:4000/agreements/{AGREEMENT_ID}/apply-template/{TEMPLATE_ID}?year=2025 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{}'
```

### Get Activities from POA Period
```bash
curl -s -X GET "http://localhost:4000/agreement-activities?poaPeriodId={POA_ID}" \
  -H "Authorization: Bearer $TOKEN" | jq .
```

### Update Activity Progress
```bash
curl -X PATCH http://localhost:4000/agreement-activities/{ACTIVITY_ID} \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "progress": 50,
    "status": "IN_PROGRESS"
  }'
```

---

## ‚úÖ Verification Checklist

After completing tests:

- [ ] Health endpoint responds
- [ ] Login returns JWT token
- [ ] Programs list returns data
- [ ] Template created with valid ID
- [ ] Activity added to template
- [ ] Template retrieved with activities
- [ ] Agreements list returns data
- [ ] Template applied to agreement successfully
- [ ] New POA Period created
- [ ] Activities copied to agreement-activities
- [ ] Activity progress can be updated
- [ ] Activity status can be changed
- [ ] All changes persist after reloading

---

## üöÄ Next Steps

1. **Start Docker:** `docker-compose up -d`
2. **Wait 30 seconds** for services to fully initialize
3. **Run tests:** `bash run-tests.sh`
4. **View results:** Should see "ALL TESTS PASSED"
5. **Test Frontend:** http://localhost:3000 ‚Üí Login ‚Üí Create/Apply templates
6. **Verify:** Actividades should be grouped by programa

---

## üìû Support

If credentials don't work:
- Check that docker-compose up -d completed successfully
- Wait 30-60 seconds for database initialization
- Check logs: `docker-compose logs -f`
- Verify database is accessible: `docker-compose exec postgres psql -U poauser -d poa_tracker -c "SELECT COUNT(*) FROM users;"`

---

**Ready to test? Run this command:**

```bash
cd "c:/Users/Usuario/Documents/POA TRACKER" && docker-compose up -d && sleep 30 && bash run-tests.sh
```

Then enjoy the green checkmarks! ‚ú®
